<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Payment Portal</title>
    <style>
        .container {
            max-width: 500px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            padding: 10px;
            width: 100%;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Department Payment Portal</h2>

    <div class="form-group">
        <label for="paymentType">Select Payment Type</label>
        <select id="paymentType">
            <option value="fine">Fine</option>
            <option value="courtFee">Court Fee</option>
            <option value="judicialDeposit">Judicial Deposit</option>
            <option value="penalty">Penalty</option>
            <option value="others">Others</option>
        </select>
    </div>

    <div class="form-group">
        <label for="courtType">Select Court Type</label>
        <select id="courtType">
            <option value="districtCourt">District Court</option>
            <option value="highCourt">High Court</option>
        </select>
    </div>

    <div class="form-group">
        <label for="CNRNumber">CNR Number</label>
        <input type="text" id="CNRNumber" placeholder="Enter CNR Number" required>
    </div>

    <div class="form-group">
        <label for="amount">Amount</label>
        <input type="number" id="amount" placeholder="Enter Amount" required>
    </div>

    <div class="form-group">
        <label for="mobile">Mobile Number</label>
        <input type="text" id="mobile" placeholder="Enter Mobile Number" required>
    </div>

    <button id="pay-button">Pay Now</button>
</div>

<!-- Include Razorpay Checkout Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    document.getElementById('pay-button').onclick = function(e) {
        e.preventDefault();

        // Capture input values
        const paymentType = document.getElementById('paymentType').value;
        const courtType = document.getElementById('courtType').value;
        const CNRNumber = document.getElementById('CNRNumber').value;
        const amount = document.getElementById('amount').value;
        const mobile = document.getElementById('mobile').value;

        // Basic validation
        if (!CNRNumber || !amount || !mobile) {
            alert("Please fill in all the fields.");
            return;
        }

        // Fetch Razorpay order ID from backend
        fetch('/create-order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                amount: amount * 100, // Razorpay accepts amounts in paise
                paymentType: paymentType,
                courtType: courtType,
                CNRNumber: CNRNumber,
                mobile: mobile
            })
        })
        .then(response => response.json())
        .then(order => {
            if (!order.id) {
                throw new Error('Order creation failed');
            }

            // Razorpay payment options
            const options = {
                "key": "YOUR_RAZORPAY_KEY",  // Replace with your Razorpay Key ID
                "amount": order.amount, // Amount in paise
                "currency": "INR",
                "name": "Court Payment",
                "description": `${paymentType} Payment for ${courtType}`,
                "order_id": order.id,  // Order ID from Razorpay
                "handler": function (response) {
                    // Handle payment success (verify on server)
                    fetch('/payment/verify', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_signature: response.razorpay_signature
                        })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert('Payment successful!');
                        } else {
                            alert('Payment verification failed.');
                        }
                    })
                    .catch(err => {
                        alert('Error verifying payment.');
                        console.error(err);
                    });
                },
                "prefill": {
                    "name": "", // You can pre-fill the name of the user
                    "email": "", // You can pre-fill the email of the user
                    "contact": mobile // Mobile number
                },
                "theme": {
                    "color": "#3399cc"
                }
            };

            // Open Razorpay payment window
            const rzp1 = new Razorpay(options);
            rzp1.open();
        })
        .catch(error => {
            console.error("Error:", error);
            alert('Error initiating payment.');
        });
    }
</script>

</body>
</html>
